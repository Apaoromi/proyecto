<!DOCTYPE html>
<html lang="es">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>eMercado - Todo lo que busques está aquí</title>

  <link href="https://fonts.googleapis.com/css?family=Raleway:300,300i,400,400i,700,700i,900,900i" rel="stylesheet">
  <link href="css/font-awesome.min.css" rel="stylesheet">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
  <style>
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap');
</style>
</head>

<body class="body-product">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark p-1">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav w-100 justify-content-between">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Inicio</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="categories.html">Categorías</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="sell.html">Vender</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="login.html">Registrarse</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- BUSCADOR  -->
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="input-group mb-3">
                    <input type="search" id="searchInput" class="form-control" placeholder="Buscar productos por nombre o descripción..." aria-label="Buscar productos">
                    <span class="input-group-text">
                        <i class="fa fa-search"></i>
                    </span>
                </div>
            </div>
        </div>
    </div>
 <main class="container mt-4">
    <script src="js/bootstrap.bundle.min.js"></script>

  <div class="img-container">
    <h2 class="img-titulo">A un solo click del auto de tus sueños ...</h2>
    <div class="imagen-ruta"></div>
</div>
  
  <main class="pb-5 container">
    <div class="container">
       <h1 id="titulo-autos">             Vehículos disponibles</h1>
       <hr>
  <div id="product-list" class="product-list"></div>
      </div>
    </div>
  </main>
  <footer class="text-muted">
    <div class="container">
      <p class="float-end">
        <a href="#">Volver arriba</a>
      </p>
      <p>Este sitio forma parte de <a href="https://jovenesaprogramar.edu.uy/" target="_blank">Jovenes a Programar</a></p>
    </div>
  </footer>
  <div id="spinner-wrapper">
    <div class="lds-ring">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="js/init.js"></script>
  <script src="js/products.js"></script>
 <script>
    // Función para inicializar el buscador
    function initSearch() {
      const searchInput = document.getElementById('searchInput');
      const noResults = document.getElementById('no-results');
      let productContainers = [];
      
      // Esperar a que los productos se carguen
      const checkProductsLoaded = setInterval(() => {
        // Buscar contenedores de productos - ajustado según tu estructura
        productContainers = document.querySelectorAll('.product-container, .list-group-item, .card, [class*="product"]');
        
        // Si no encontramos contenedores, buscar por la estructura de contenido
        if (productContainers.length === 0) {
          // Buscar elementos que contengan títulos h1, h2, h3, h4 (que parecen ser tus productos)
          const headings = document.querySelectorAll('h1, h2, h3, h4');
          headings.forEach(heading => {
            // Si el heading tiene texto similar a un producto
            if (heading.textContent && heading.textContent.length > 3 && 
                !heading.textContent.includes('Vehículos disponibles')) {
              // Encontrar el contenedor padre que probablemente contiene el producto completo
              let container = heading.parentElement;
              if (container && !container.classList.contains('product-marked')) {
                container.classList.add('product-container', 'product-marked');
                productContainers = document.querySelectorAll('.product-container');
              }
            }
          });
        }
        
        if (productContainers.length > 0) {
          clearInterval(checkProductsLoaded);
          console.log('Productos encontrados:', productContainers.length);
          setupSearch();
        }
      }, 500);
      
      function setupSearch() {
        searchInput.addEventListener('input', function() {
          const searchText = this.value.toLowerCase().trim();
          let hasResults = false;
          
          productContainers.forEach(function(container) {
            // Buscar todos los elementos de texto dentro del contenedor
            const textContent = container.textContent.toLowerCase();
            
            // Verificar si coincide con la búsqueda
            if (searchText === '' || textContent.includes(searchText)) {
              container.style.display = 'block';
              hasResults = true;
              
              // Resaltar texto si es necesario
              if (searchText !== '') {
                highlightTextInContainer(container, searchText);
              }
            } else {
              container.style.display = 'none';
            }
          });
          
          // Mostrar u ocultar mensaje de no resultados
          if (!hasResults && searchText !== '') {
            noResults.style.display = 'block';
          } else {
            noResults.style.display = 'none';
          }
        });
      }
      
      // Función para resaltar texto en todo el contenedor
      function highlightTextInContainer(container, searchText) {
        const walker = document.createTreeWalker(
          container, 
          NodeFilter.SHOW_TEXT, 
          null, 
          false
        );
        
        let node;
        const nodes = [];
        
        while (node = walker.nextNode()) {
          if (node.textContent.toLowerCase().includes(searchText)) {
            nodes.push(node);
          }
        }
        
        nodes.forEach(node => {
          const span = document.createElement('span');
          span.innerHTML = node.textContent.replace(
            new RegExp(`(${searchText})`, 'gi'),
            '<span class="search-highlight">$1</span>'
          );
          node.parentNode.replaceChild(span, node);
        });
      }
    }
    
    // Iniciar el buscador cuando el DOM esté listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initSearch);
    } else {
      initSearch();
    }
  </script>
</body>
</html>